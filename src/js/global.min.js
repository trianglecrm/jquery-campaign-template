var globalFunctions=function(){function e(){t.eventsHandler(),$(".getDate").html(t.getDate($(".getDate").attr("data-day"))),$(".onlyNumbers").keypress(function(e){return 8==e.charCode||0==e.charCode?!0:e.charCode<48||e.charCode>57?!1:void 0}),$(document).ready(function(){ie&&$("form").validate({errorClass:"authError",errorElement:"span"}),$(".CS_div1 a img").attr("src","/img/offers/"+downSell.split(".")[0]+".jpg")})}var t={};return t.alert=function(e){jError("<div>We are sorry but we could not process your request.<br/><h2>"+e+"</h2>Please correct and try again.</div>",{autoHide:!0,TimeShown:3e3,HorizontalPosition:"center",onCompleted:function(){}})},t.ServiceHandlerPost=function(e,t){return $.post("TriangleCRM/Controller.php",{action:e,data:t})},t.setCookie=function(e,t){$.cookie(e,JSON.stringify(t))},t.removeCookie=function(e){$.removeCookie(e)},t.getCookie=function(e){return $.cookie(e)?JSON.parse($.cookie(e)):""},t.encryptData=function(e){var t="-----BEGIN PUBLIC KEY-----MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAM1RXGYKyXlCGcGvFYeNCD+yzVAOoK+w2awyE6vOCSqhR0pAWFgpWOuwbrL5M78PILmZc85ipbzoz6Vtv4IvYJUCAwEAAQ==-----END PUBLIC KEY-----",r=RSA.getPublicKey(t);return RSA.encrypt(e,r)},t.getDate=function(e){var t=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),r=new Array("January","February","March","April","May","June","July","August","September","October","November","December"),a=new Date;a.setDate(a.getDate()+e);var n=t[a.getDay()]+", "+r[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear();return n},t.getYear=function(){var e=new Date,t=e.getFullYear();document.write(t)},t.processer=function(e){"show"==e?($("#button-processing").show(),$("#button-submit").hide()):($("#button-processing").hide(),$("#button-submit").show())},t.getParameterByName=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",r=new RegExp(t),a=r.exec(window.location.href);return null==a?"":decodeURIComponent(a[1].replace(/\+/g," "))},t.eventsHandler=function(){},t.init=e(),t}(),infoModule=function(e){function t(){e.getParameterByName("redirected")&&e.alert("You're here because this information is needed")}function r(){return $("form").valid()&&(a(),e.processer("show"),jsonObj=JSON.stringify(n),e.ServiceHandlerPost("createprospect",jsonObj).done(function(t){console.log(t),t=JSON.parse(t),"Success"==t.State?(n.ProspectID=t.Result.ProspectID,console.log(n),e.setCookie("billingInfo",n),internal=!0,window.location.href="/order.php"):(e.processer(),e.alert(t.Info))})),!1}function a(){n.step="1",n.hasFormSubmitted="",n.campaign_id="117",n.domain_name=location.host+"/specialoffer/",n.country="US",n.firstname=$("#fields_fname").val()||"",n.lastname=$("#fields_lname").val()||"",n.address1=$("#fields_address1").val()||"",n.address2=$("#fields_address2").val()||"",n.city=$("#fields_city").val()||"",n.state=$("#fields_state").val()||"",n.zip=$("#fields_zip").val()||"",n.country=$("#fields_country").val()||n.country,n.phone=$("#fields_phone").val()||"",n.email=$("#fields_email").val()||""}var n={},o={};return o.init=t(),o.save=r,o.billingInfo=n,o}(globalFunctions),ccModule=function(e){function t(){for(o.eventsHandler(),s=e.getCookie("billingInfo"),void 0==s&&(window.location.href="/index.php?redirected=1"),j=(new Date).getFullYear(),i=j;j+12>i;i++)$("#expYear").append($("<option />").val(i).html(i))}function r(){if($("form").valid()){a();var t=n.creditCard;n.creditCard=e.encryptData(n.creditCard),e.processer("show"),jsonObj=JSON.stringify(n),e.ServiceHandlerPost("CreateSubscription",jsonObj).done(function(r){r=JSON.parse(r),"Success"==r.State?(internal=!0,window.location.href="/"+n.successRedirect):"Test charge. ERROR"==r.Info?(internal=!0,window.location.href="/"+n.successRedirect+"?successDownSell="+orderSettings.Result.successDownSell):($("#creditCard").val(t),e.processer(),e.alert(r.Info))})}return!1}function a(){n.planID=orderSettings.Result.planID,n.trialPackageID=orderSettings.Result.trialPackageID,n.chargeForTrial=orderSettings.Result.chargeForTrial,n.campaign_id=orderSettings.Result.campaign_id,n.firstName=s.firstname||"",n.lastName=s.lastname||"",n.address1=s.address1||"",n.address2=s.address2||"",n.city=s.city||"",n.state=s.state||"",n.zip=s.zip||"",n.country=s.country||"",n.phone=s.phone||0,n.email=s.email||"",n.sendConfirmationEmail=orderSettings.Result.sendConfirmationEmail,n.affiliate=e.getParameterByName("aff")||"",n.subAffiliate=e.getParameterByName("sub")||"",n.prospectID=s.ProspectID,n.description=orderSettings.Result.description||"",n.successRedirect=orderSettings.Result.successRedirect||"",n.paymentType=$("#paymentMethod").val()||"",n.creditCard=$("#creditCard").val()||"",n.expMonth=$("#expMonth").val()||"",n.expYear=$("#expYear").val()||"",n.cvv=$("#cvv").val()||""}var n={},o={},s={};return o.eventsHandler=function(){$(".cvv-help").stop(!0,!1).mouseover(function(){$(".whatiscvv").show("slow")}).mouseout(function(){$(".whatiscvv").stop(!0,!1).hide("slow")}),$("#paymentMethod").on("change",function(){type=this.value,1==type?($("#creditCard").attr("pattern","{15}"),$("#creditCard").attr("maxlength","15"),$("#creditCard").mask("9999-999999-99999"),$("#cvv").attr("pattern","[0-9]{4}"),$("#cvv").mask("9999"),$("#cvv").attr("maxlength","4")):($("#creditCard").attr("pattern","{13,16}"),$("#creditCard").attr("maxlength","16"),$("#creditCard").mask("9999-9999-9999-9999"),$("#cvv").attr("pattern","[0-9]{3}"),$("#cvv").mask("999"),$("#cvv").attr("maxlength","3"))}),$("#expMonth , #expYear").on("change",function(){return selectedMonth=$("#expMonth").val(),selectedYear=$("#expYear").val(),selectedMonth&&selectedYear&&(today=new Date,selected=new Date,selected.setMonth(selectedMonth),selected.setYear(selectedYear),today>=selected)?(e.alert("Please select a valid date!"),$("#expMonth").val(""),$("#expYear").val(""),!1):void 0}),$("#creditCard").blur(function(){var t=$("#paymentMethod").val();creditCard=$("#creditCard").val(),void 0==t?e.alert("Please select a Card Type first"):void 0==creditCard||(1==t?15!=creditCard.toString().length&&e.alert("The credit card number for AMEX should have 15 digits"):16!=creditCard.toString().length&&e.alert("The credit card number for Visa, MasterCard and Discover should have 15 digits"))}),$("#cvv").blur(function(){var t=$("#paymentMethod").val(),r=$("#cvv").val();void 0==t?e.alert("Please select a Card Type first"):void 0==r||(1==t?4!=r.toString().length&&e.alert("The CVV number for AMEX should have 4 digits"):3!=r.toString().length&&e.alert("The CVV number for Visa, MasterCard and Discover should have 3 digits"))})},o.init=t(),o.save=r,o.ccinfo=n,o}(globalFunctions);